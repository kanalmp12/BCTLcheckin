<!doctype html>
<html lang="th">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>เช็คชื่อห้องประชุม • BUCA Talent</title>
    <meta name="description"
        content="หน้าเช็คชื่อเข้าประชุมแบบเบา เร็ว ปลอดเฟรมเวิร์ก เก็บข้อมูลลง Google Sheets พร้อมล็อกรัศมีไม่เกิน 50 เมตรจากห้องประชุม.">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0b0b0b">
    <style>
        :root {
            --radius: 12px;
            --brand: #008a6a;
            --brand-dark: #25a18e;
            --text: #111;
            --bg: #fff;
            --muted: #6b6b6b;
            --bd: #e5e5e5
        }

        @media (prefers-color-scheme:dark) {
            :root {
                --text: #e9e9e9;
                --bg: #0b0b0b;
                --bd: #2a2a2a
            }
        }

        * {
            box-sizing: border-box
        }

        html {
            scroll-behavior: smooth
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
            line-height: 1.5;
            color-scheme: light dark;
            background: var(--bg);
            color: var(--text)
        }

        footer,
        header,
        main {
            max-width: 720px;
            margin: auto;
            padding: 16px
        }

        h1,
        h2 {
            line-height: 1.2;
            margin: .2em 0
        }

        .lead {
            opacity: .9
        }

        .card {
            border: 1px solid var(--bd);
            border-radius: var(--radius);
            padding: 16px;
            background: var(--bg)
        }

        a {
            color: inherit
        }

        img {
            max-width: 100%;
            height: auto;
            display: block
        }

        label {
            font-weight: 600;
            display: block
        }

        button,
        input,
        output,
        select {
            font: inherit
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #cfcfcf;
            border-radius: 10px;
            background: 0 0;
            color: inherit
        }

        @media (prefers-color-scheme:dark) {

            input,
            select {
                border-color: #3a3a3a
            }
        }

        button {
            padding: 12px 16px;
            border: 0;
            border-radius: 999px;
            background: var(--brand);
            color: #fff;
            font-weight: 700;
            cursor: pointer
        }

        button[disabled] {
            opacity: .5;
            cursor: not-allowed
        }

        .muted {
            opacity: .8;
            font-size: .95rem;
            color: var(--muted)
        }

        .row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px
        }

        @media (min-width:600px) {
            .row {
                grid-template-columns: 1fr 1fr
            }
        }

        .sr-only {
            position: absolute;
            left: -10000px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden
        }

        header nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px
        }

        .pill {
            font-size: .85rem;
            border: 1px solid #dcdcdc;
            border-radius: 999px;
            padding: 4px 10px;
            display: inline-block
        }

        .kpi {
            display: flex;
            gap: 10px;
            align-items: center
        }

        .kpi span {
            font-weight: 700
        }

        .space {
            height: 32px
        }

        @media (prefers-color-scheme:dark) {
            button {
                background: var(--brand-dark)
            }
        }

        @media (prefers-reduced-motion:reduce) {
            * {
                scroll-behavior: auto
            }
        }
    </style>
</head>

<body><a class="sr-only" href="#main">ข้ามไปเนื้อหา</a>
    <header role="banner" aria-label="หัวข้อหน้า">
        <nav><strong>Check‑in</strong><span class="pill" aria-label="สถานะความพร้อม">เวอร์ชัน • Cloudflare Pages</span>
        </nav>
        <h1>เช็คชื่อห้องประชุม BUCA Talent</h1>
        <p class="lead">ระบบกำลังโหลดการตั้งค่าและตำแหน่ง...</p>
    </header>
    <main id="main" role="main">
        <section class="card" aria-labelledby="form-title">
            <h2 id="form-title">ยืนยันตัวตน &amp; ตำแหน่ง</h2>
            <form id="checkin" aria-describedby="help" class="row">
                <fieldset style="border:0;padding:0;margin:0" class="row">
                    <legend class="sr-only">ข้อมูลผู้เข้าร่วม</legend><label for="name">ชื่อเล่น<input id="name"
                            name="name" autocomplete="name" required placeholder="เช่น รูบี้จัง"></label> <label
                        for="dept">ฝ่าย <select id="dept" name="dept" required>
                            <option value="" selected="selected" disabled="disabled">เลือกฝ่าย</option>
                            <option value="Organize">ORGANIZE (OG)</option>
                            <option value="Public Relations">PUBLIC RELATIONS (PR)</option>
                            <option value="Production">MEDIA PRODUCTION (PRO)</option>
                            <option value="Visual Arts">VISUAL ART (VFX)</option>
                        </select></label> <label for="cohort">รุ่น <select id="cohort" name="cohort" required>
                            <option value="" selected="selected" disabled="disabled">เลือกรุ่น</option>
                            <option value="12">รุ่น 12</option>
                            <option value="13">รุ่น 13</option>
                        </select></label> <label for="distance">ระยะห่างจากห้อง (เมตร)<output id="distance"
                            name="distance" aria-live="polite" class="pill"
                            style="display:block;padding:8px 12px">–</output></label> <input type="text" id="website"
                        name="website" class="sr-only" tabindex="-1" autocomplete="off" aria-hidden="true">
                </fieldset>
                <div class="space"></div>
                <div class="kpi" aria-live="polite" aria-atomic="true"><span id="status">กำลังรอการตั้งค่าระบบ...</span>
                </div>
                <div class="space"></div>
                <div><button id="submit" type="submit" disabled="disabled" aria-disabled="true">เช็คชื่อ</button> <span
                        class="muted" id="help">ระบบจะบันทึกเวลาและตำแหน่งปัจจุบัน</span></div>
            </form>
        </section>
        <section class="card" aria-labelledby="sec2">
            <h2 id="sec2">ข้อมูลและความเป็นส่วนตัว</h2>
            <p class="muted">ระบบจะบันทึก: เวลา, ชื่อ, ฝ่าย, รุ่น, พิกัด (lat, lng), ความคลาดเคลื่อน, ระยะห่างจากห้อง
                และ User‑Agent เพื่อความปลอดภัย</p>
        </section>
    </main>
    <footer role="contentinfo">
        <p class="muted">© <span id="year"></span> BUCA Talent | <a href="#" rel="noopener">นโยบายความเป็นส่วนตัว</a>
        </p>
    </footer><noscript>
        <p>จำเป็นต้องเปิดใช้งาน JavaScript เพื่อเช็คชื่อและยืนยันรัศมี</p>
    </noscript>
    <script>
        // CONFIGURATION: PASTE YOUR NEW GOOGLE SCRIPT URL HERE
        const GOOGLE_SCRIPT_URL = "";

        !function () {
            "use strict"; const t = { form: document.getElementById("checkin"), name: document.getElementById("name"), dept: document.getElementById("dept"), cohort: document.getElementById("cohort"), submitBtn: document.getElementById("submit"), distOutput: document.getElementById("distance"), status: document.getElementById("status"), year: document.getElementById("year") }; t.year.textContent = (new Date).getFullYear(); let e = { targetLat: null, targetLng: null, scriptUrl: GOOGLE_SCRIPT_URL, isLoaded: !1 }; const n = { lat: null, lng: null, acc: null, dist: null, ok: !1 }; function a(t) { return t * Math.PI / 180 } function o() { null !== n.dist && (t.distOutput.value = Math.round(n.dist) + " m"); const a = t.name.value.trim() && t.dept.value && t.cohort.value, o = e.isLoaded; t.submitBtn.disabled = !(n.ok && a && o), t.submitBtn.setAttribute("aria-disabled", t.submitBtn.disabled ? "true" : "false") } function s() { "geolocation" in navigator ? (t.status.textContent = "กำลังระบุตำแหน่ง...", navigator.geolocation.getCurrentPosition(s => { const r = s.coords; n.lat = r.latitude, n.lng = r.longitude, n.acc = r.accuracy, e.targetLat && e.targetLng ? (n.dist = function (t, e, n, o) { const s = a(t), r = a(n), u = a(n - t), i = a(o - e), c = Math.sin(u / 2) * Math.sin(u / 2) + Math.cos(s) * Math.cos(r) * Math.sin(i / 2) * Math.sin(i / 2); return 2 * Math.atan2(Math.sqrt(c), Math.sqrt(1 - c)) * 6371e3 }(n.lat, n.lng, e.targetLat, e.targetLng), n.ok = n.dist <= 50, n.ok ? (t.status.textContent = "คุณอยู่ในรัศมีที่กำหนด ✅", t.status.style.color = "var(--brand)") : (t.status.textContent = "อยู่นอกรัศมี 50 เมตร ❌", t.status.style.color = "#d32f2f")) : t.status.textContent = "รอข้อมูลพิกัดเป้าหมาย...", o() }, e => { t.status.textContent = e && e.message ? e.message : "ไม่สามารถระบุตำแหน่งได้", t.status.style.color = "inherit" }, { enableHighAccuracy: !0, timeout: 1e4, maximumAge: 0 })) : t.status.textContent = "อุปกรณ์นี้ไม่รองรับตำแหน่ง" } document.addEventListener("DOMContentLoaded", async function () {

                if (!GOOGLE_SCRIPT_URL) {
                    t.status.textContent = "Error: Google Script URL not set in index.html";
                    return;
                }

                try {
                    t.status.textContent = "กำลังเชื่อมต่อ Server...";
                    // Fetch config from GAS
                    const connector = GOOGLE_SCRIPT_URL.includes('?') ? '&' : '?';
                    const n = await fetch(`${GOOGLE_SCRIPT_URL}${connector}action=getConfig`);
                    if (!n.ok) throw new Error(`Server Error: ${n.status} ${n.statusText}`);
                    const a = await n.json();

                    if (!a.targetLat || !a.targetLng) throw new Error("Incomplete Config: Missing Lat/Lng in Google Sheet");

                    e.targetLat = parseFloat(a.targetLat), e.targetLng = parseFloat(a.targetLng), e.isLoaded = !0, console.log("Config loaded via Google Apps Script"), s()
                } catch (e) {
                    console.error("Config Error:", e), t.status.textContent = `โหลดค่าไม่สำเร็จ: ${e.message}`
                }
            }), document.addEventListener("input", o), document.addEventListener("change", o), t.form.addEventListener("submit", async a => { if (a.preventDefault(), t.submitBtn.disabled) return; const s = document.getElementById("website"); if (s && s.value) return void (t.status.textContent = "บล็อกบอท"); t.submitBtn.disabled = !0, t.status.textContent = "กำลังบันทึก..."; const r = { timestamp: (new Date).toISOString(), name: t.name.value.trim(), department: t.dept.value, cohort: t.cohort.value, lat: n.lat, lng: n.lng, accuracy: n.acc, distance_m: Math.round(n.dist || 0), ua: navigator.userAgent }; try { await fetch(e.scriptUrl, { method: "POST", mode: "no-cors", body: JSON.stringify(r) }), t.status.textContent = "เช็คชื่อเรียบร้อย ✔ กำลังรีเฟรช...", t.form.reset(), n.ok = !1, t.distOutput.value = "–", o(), setTimeout(function () { window.location.reload() }, 1200) } catch (e) { t.status.textContent = "เกิดข้อผิดพลาดของเครือข่าย", t.submitBtn.disabled = !1 } })
        }()
    </script>
</body>

</html>